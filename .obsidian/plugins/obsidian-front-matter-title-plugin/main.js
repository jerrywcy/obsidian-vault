/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Y=Object.create;var b=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols,te=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var K=(s,e,t)=>e in s?b(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,$=(s,e)=>{for(var t in e||(e={}))j.call(e,t)&&K(s,t,e[t]);if(W)for(var t of W(e))ie.call(e,t)&&K(s,t,e[t]);return s};var q=s=>b(s,"__esModule",{value:!0});var re=(s,e)=>{q(s);for(var t in e)b(s,t,{get:e[t],enumerable:!0})},se=(s,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ee(e))!j.call(s,r)&&r!=="default"&&b(s,r,{get:()=>e[r],enumerable:!(t=Z(e,r))||t.enumerable});return s},D=s=>se(q(b(s!=null?Y(te(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var n=(s,e,t)=>new Promise((r,i)=>{var a=h=>{try{l(t.next(h))}catch(d){i(d)}},o=h=>{try{l(t.throw(h))}catch(d){i(d)}},l=h=>h.done?r(h.value):Promise.resolve(h.value).then(a,o);l((t=t.apply(s,e)).next())});re(exports,{default:()=>G});var x=D(require("obsidian"));var B=D(require("obsidian"));var E=class{process(e){this.promise=new Promise((t,r)=>n(this,null,function*(){try{let i=yield e;i=i===null||i===""?null:i,this.title=i,this.promise=null,t(this.title)}catch(i){r(i)}}))}await(){return n(this,null,function*(){var e;return(e=this.promise)!=null?e:this.title})}isResolved(){return this.promise===null}getResolved(){return this.title}};var g=class extends Error{};var M=class{constructor(e){this.template=e;this.metaPaths=[];this.pattern=V;this.parse()}buildTitle(e){var r;let t=this.template;for(let i of this.metaPaths){if(e[i]===void 0)throw new g(`Template path ${i} is undefined`);t=t.replace(`{{${i}}}`,(r=e[i])!=null?r:"")}return(t==null?void 0:t.length)>0?t:null}getMetaPaths(){return this.metaPaths}parse(){let e=this.template.match(new RegExp(this.pattern,"g"));for(let t of e){let{groups:{title:r}}=t.match(this.pattern);this.metaPaths.push(r)}}};var P=class{constructor(e){this.template=e}buildTitle(e){if(e[this.template]===void 0)throw new g(`Title path ${this.template} is undefined`);let t=e[this.template];return(t==null?void 0:t.length)>0?t:null}getMetaPaths(){return[this.template]}};var V="{{(?<title>.*?)}}",T=class{static create(e){return new RegExp(V).test(e)?new M(e):new P(e)}};var u=class{constructor(e,t,r){this.cache=e;this.parser=t;this.listeners=new Map;this.template=null;this.collection=new Map,this.options=$({},r),this.template=T.create(this.options.metaPath)}static getPathByAbstract(e){return e instanceof B.TAbstractFile?e.path:e}on(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),this}removeAllListeners(e){this.listeners.delete(e)}setExcluded(e){let t=this.options.excluded.some(i=>!e.includes(i)),r=e.some(i=>!this.options.excluded.includes(i));if((t||r)&&(this.options.excluded=e),r)for(let i of this.collection.keys())this.isExcluded(i)&&(this.collection.delete(i),t=!0);t&&this.emit("unresolved")}setMetaPath(e){this.options.metaPath!==e&&(this.revokeAll(),this.options.metaPath=e,this.template=T.create(e),this.emit("unresolved"))}isSupported(e){return!this.isExcluded(e)&&/\.md$/.test(e)}isResolved(e){var r;let t=u.getPathByAbstract(e);return(r=this.collection.get(t))==null?void 0:r.isResolved()}getResolved(e){var r,i;let t=u.getPathByAbstract(e);return(i=(r=this.collection.get(t))==null?void 0:r.getResolved())!=null?i:null}resolve(e){return n(this,null,function*(){let t=this.getOrCreate(u.getPathByAbstract(e));return t?t.await():null})}revoke(e){this.collection.delete(u.getPathByAbstract(e))}revokeAll(){this.collection.clear()}emit(e){var t;for(let r of(t=this.listeners.get(e))!=null?t:[])r()}isExcluded(e){for(let t of this.options.excluded)if(new RegExp(`^${t}`).test(e))return!0;return!1}getOrCreate(e){if(this.isSupported(e)){if(!this.collection.has(e)){let t=new E;t.process(this.makeTitle(e)),this.collection.set(e,t)}return this.collection.get(e)}return null}makeTitle(e){return n(this,null,function*(){var a,o;let t=(o=(a=this.cache.getCache(e))==null?void 0:a.frontmatter)!=null?o:{},r=this.template.getMetaPaths(),i=Object.fromEntries(r.map(l=>[l,this.parser.parse(l,t)]));return this.template.buildTitle(i)})}};var c=D(require("obsidian")),ae={explorer_enabled:"m_explorer",graph_enabled:"m_graph"},w=class{constructor(e,t){this.cb=t;this.settings=Object.assign({},w.getDefault(),e);let r=Object.entries(ae);for(let[i,a]of r)this.settings[i]!==void 0&&(this.settings[a]=this.settings[i],delete this.settings[i])}static getDefault(){return{path:"title",list_pattern:!0,excluded_folders:[],m_graph:!0,m_explorer:!0,m_markdown:!0}}set(e,t){this.settings[e]=t,this.cb(this.getAll())}get(e){return this.set("m_markdown",!0),this.settings[e]}getAll(){return this.settings}},C=class extends c.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Settings for plugin."}),new c.Setting(e).setName("Front matter title path").setDesc('Set a yaml path, which value will be used as a file title. Value must be string or numeric. Also you can use template-like path using "{{ }}". See Readme to find out').addText(t=>t.setPlaceholder("Type path").setValue(this.plugin.settings.get("path")).onChange(r=>n(this,null,function*(){this.plugin.settings.set("path",r)}))),this.buildDelimiter(),new c.Setting(e).setName("Exclude folders").setDesc("Set excluded folders and files in this folders will not be parsed").addTextArea(t=>t.setValue(this.plugin.settings.get("excluded_folders").join(`
`)).onChange(r=>n(this,null,function*(){this.plugin.settings.set("excluded_folders",r.split(`
`).filter(i=>i))}))),this.buildMangers()}buildMangers(){this.containerEl.createEl("h4",{text:"Managers"}),new c.Setting(this.containerEl).setName("Enable explorer titles").setDesc("If it is on, plugin will replace titles in file explorer and update them").addToggle(e=>e.setValue(this.plugin.settings.get("m_explorer")).onChange(t=>n(this,null,function*(){this.plugin.settings.set("m_explorer",t)}))),new c.Setting(this.containerEl).setName("Enable graph titles").setDesc("If it is on, plugin will replace titles in graph and update them").addToggle(e=>e.setValue(this.plugin.settings.get("m_graph")).onChange(t=>n(this,null,function*(){this.plugin.settings.set("m_graph",t)}))),new c.Setting(this.containerEl).setName("Enable leaf`s header titles").setDesc("If it is on, plugin will replace titles in graph and update them. Also it will prevent click on header to avoid accidentally renaming").addToggle(e=>e.setValue(this.plugin.settings.get("m_markdown")).onChange(t=>n(this,null,function*(){this.plugin.settings.set("m_markdown",t)})))}buildDelimiter(){let e=new c.Setting(this.containerEl).setName("List value behaviour").setDesc("Plugin can use first value from list values or join all once by delimiter"),t=null;e.addDropdown(i=>i.addOptions({true:"Use first value",delimiter:"Join all by delimiter"}).setValue(this.plugin.settings.get("list_pattern")===!0?"true":"delimiter").onChange(a=>r(a==="delimiter"))),e.addText(i=>{t=i.onChange(a=>this.plugin.settings.set("list_pattern",a))});let r=i=>{i?t.setValue(this.plugin.settings.get("list_pattern")).setPlaceholder("Type a delimiter").setDisabled(!1):(t.setValue("").setPlaceholder("First value will be used").setDisabled(!0),this.plugin.settings.set("list_pattern",!0))};r(this.plugin.settings.get("list_pattern")!==!0)}};var p;(function(i){i.FE="file-explorer",i.G="graph",i.LG="localgraph",i.MD="markdown"})(p||(p={}));var k=class{constructor(e,t){this.workspace=e;this.resolver=t;this.original=new Map;this.bound=!1;this.handlers={"layout-change":()=>this.update(),mousedown:e=>e.preventDefault()};this.enabled=!1}disable(){for(let e of this.workspace.getLeavesOfType(p.MD))this.setTitle(e.view,null);this.original.clear(),this.enabled=!1,this.bound&&(this.workspace.off("layout-change",this.handlers["layout-change"]),this.bound=!1)}enable(){this.enabled=!0,this.bound||(this.workspace.on("layout-change",this.handlers["layout-change"]),this.bound=!0)}isEnabled(){return this.enabled}update(e){return n(this,null,function*(){if(!this.isEnabled())return Promise.resolve(!1);let t=this.workspace.getLeavesOfType(p.MD),r=[];for(let i of t){let a=i.view;a.file.path===(e==null?void 0:e.path)?this.setTitle(a,yield this.resolver.resolve(a.file)):e||r.push(this.resolver.resolve(a.file).then(o=>[a,o]))}for(let[i,a]of yield Promise.all(r))this.setTitle(i,a);return Promise.resolve(!0)})}setTitle(e,t){t&&t!==e.titleEl.innerText?(this.original.set(e.file.path,e.titleEl.innerText),e.titleEl.innerText=t,e.titleEl.contentEditable="false",e.titleEl.addEventListener("mousedown",this.handlers.mousedown)):!t&&this.original.has(e.file.path)&&(e.titleEl.innerText=this.original.get(e.file.path),e.titleEl.contentEditable="true",e.titleEl.removeEventListener("mousedown",this.handlers.mousedown))}};var S=class{constructor(e,t,r,i){this.proto=e;this.method=t;this.args=r;this.implementation=i;this.vanilla=null;this.valid()}valid(){if(typeof this.proto[this.method]!="function")throw new Error(`Method ${this.method} is not a function`)}enable(){if(this.vanilla!==null)return!1;let e=this;return this.vanilla=this.proto[this.method],this.proto[this.method]=function(...t){return e.implementation.call(this,e.args,t,e.vanilla)},!0}disable(){this.vanilla!==null&&(this.proto[this.method]=this.vanilla,this.vanilla=null)}};function Q(s,e,t){var r,i,a;e===void 0&&(e=50),t===void 0&&(t={});var o=(r=t.isImmediate)!=null&&r,l=(i=t.callback)!=null&&i,h=t.maxWait,d=Date.now(),v=[];function H(){if(h!==void 0){var m=Date.now()-d;if(m+e>=h)return h-m}return e}var L=function(){var m=[].slice.call(arguments),y=this;return new Promise(function(O,J){var z=o&&a===void 0;if(a!==void 0&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,d=Date.now(),!o){var U=s.apply(y,m);l&&l(U),v.forEach(function(X){return(0,X.resolve)(U)}),v=[]}},H()),z){var N=s.apply(y,m);return l&&l(N),O(N)}v.push({resolve:O,reject:J})})};return L.cancel=function(m){a!==void 0&&clearTimeout(a),v.forEach(function(y){return(0,y.reject)(m)}),v=[]},L}var F=class{constructor(e,t){this.items=new Set,this.cb=Q(()=>n(this,null,function*(){return e(this.items)}),t)}add(e){return this.items.add(e),this.cb()}};var f=class{constructor(e,t){this.workspace=e;this.resolver=t;this.replacement=null;this.state="disabled";this.bound=!1;this.resolved=new Map;this.queue=new F(this.runQueue.bind(this),50)}static getReplaceFunction(){return function(e,t,r){if(e.resolver.isSupported(this.id)){let i=e.resolved.get(this.id);if(i)return i;e.resolved.has(this.id)||e.queue.add(this.id).catch(console.error)}return r.call(this,...t)}}disable(){var e;(e=this.replacement)==null||e.disable(),this.reloadIframeWithNodes(new Set(this.resolved.keys())),this.resolved.clear(),this.state="disabled"}enable(){return n(this,null,function*(){this.state="enabled",yield this.initReplacement(),this.bound||(this.workspace.on("layout-change",this.initReplacement.bind(this)),this.bound=!0)})}isEnabled(){return this.state!=="disabled"}update(e=null){var r,i,a;if(!this.isEnabled())return Promise.resolve(!1);let t=this.getLeaves();t.length===0&&(e?this.resolved.delete(e.path):this.resolved.clear());for(let o of t)for(let l of(a=(i=(r=o.view)==null?void 0:r.renderer)==null?void 0:i.nodes)!=null?a:[])if(e&&e.path===l.id){this.queue.add(l.id).catch(console.error);break}else e===null&&this.queue.add(l.id).catch(console.error);return Promise.resolve(!0)}initReplacement(){return n(this,null,function*(){if(this.replacement){this.replacement.enable();return}else if(!this.isEnabled())return;let e=this.getFirstGraphNode();if(e)this.replacement=this.createReplacement(e),this.replacement.enable(),yield this.update();else if(this.getLeaves().length)return new Promise(t=>{let r=setTimeout(()=>n(this,null,function*(){let i=!this.isEnabled()||this.replacement||this.getLeaves().length===0;this.getFirstGraphNode()&&(yield this.initReplacement(),i=!0),i&&(clearTimeout(r),t())}),20)})})}getFirstGraphNode(){var e,t,r,i,a;for(let o of this.getLeaves()){let l=(a=(i=(r=(t=(e=o==null?void 0:o.view)==null?void 0:e.renderer)==null?void 0:t.nodes)!=null?r:[])==null?void 0:i.first())!=null?a:null;if(l)return l}return null}getLeaves(){return[...this.workspace.getLeavesOfType(p.G),...this.workspace.getLeavesOfType(p.LG)]}resolveTitles(e){return n(this,null,function*(){let t=[];for(let r of e)t.push(this.resolver.resolve(r).then(i=>[r,i]).catch(()=>[r,!1]));return yield Promise.all(t)})}runQueue(e){return n(this,null,function*(){let t=!1;for(let[r,i]of yield this.resolveTitles(e))t||(this.resolved.has(r)||(t=!0),this.resolved.get(r)!==i&&(t=!0)),this.resolved.set(r,i);t!==!1&&this.reloadIframeWithNodes(e),e.clear()})}reloadIframeWithNodes(e){var t,r,i,a,o;for(let l of this.getLeaves()){let h=(i=(r=(t=l==null?void 0:l.view)==null?void 0:t.renderer)==null?void 0:r.nodes)!=null?i:[];for(let d of h)if(e.has(d.id)){(o=(a=l.view)==null?void 0:a.renderer)==null||o.onIframeLoad();break}}}createReplacement(e){return new S(Object.getPrototypeOf(e),"getDisplayText",this,f.getReplaceFunction())}};var R=class{constructor(e,t){this.workspace=e;this.resolver=t;this.explorerView=null;this.originTitles=new Map;this.enabled=!1;this.isTitleEmpty=e=>e===null||e===""}isEnabled(){return this.enabled}disable(){this.explorerView&&(this.restoreTitles(),this.explorerView=null),this.enabled=!1}enable(){this.explorerView=this.getExplorerView(),this.enabled=!0}getExplorerView(){var t;let e=this.workspace.getLeavesOfType(p.FE);return e.length>1?(console.log("there is more then one explorer"),null):((t=e==null?void 0:e.first())==null?void 0:t.view)===void 0?(console.log("explorer is undefined"),null):e.first().view}update(e=null){return n(this,null,function*(){if(!this.isEnabled()||!this.explorerView)return!1;let r=(e?[this.explorerView.fileItems[e.path]]:Object.values(this.explorerView.fileItems)).map(i=>this.setTitle(i));return Promise.all(r).then(()=>!0)})}setTitle(e){return n(this,null,function*(){let t=yield this.resolver.resolve(e.file).catch(()=>null);if(this.isTitleEmpty(t))return this.restore(e);e.titleInnerEl.innerText!==t&&(this.keepOrigin(e),e.titleInnerEl.innerText=t)})}keepOrigin(e){this.originTitles.has(e.file.path)||this.originTitles.set(e.file.path,e.titleInnerEl.innerText)}restoreTitles(){Object.values(this.explorerView.fileItems).map(this.restore.bind(this))}restore(e){this.originTitles.has(e.file.path)&&(e.titleInnerEl.innerText=this.originTitles.get(e.file.path),this.originTitles.delete(e.file.path))}};var I=class{constructor(e,t){this.managers=new Map;this.managers.set(p.MD,new k(e,t)).set(p.G,new f(e,t)).set(p.FE,new R(e,t))}update(e,t){let r=[];for(let[i,a]of this.determine(t))r.push(a.update(e).then(o=>({manager:i,result:o})));return Promise.all(r)}setState(e,t){let r=e?"enable":"disable";for(let[,i]of this.determine(t))i[r]()}determine(e){return e?[[e,this.managers.get(e)]]:this.managers}};var A=class extends Error{};var _=class{constructor(){this.delimiter=null}setDelimiter(e){this.delimiter=e}getDelimiter(){return this.delimiter}parse(e,t){var a,o;if(e==="")throw new A(`Meta path is empty (got "${e}")`);let r=e.split("."),i=t;for(let l of r)if(i=(a=i==null?void 0:i[l])!=null?a:null,i===null)return null;switch(typeof i){case"number":return String(i);case"string":return i;default:{if(Array.isArray(i))return this.delimiter===null?(o=i[0])!=null?o:null:i.filter(l=>l).join(this.getDelimiter());throw new TypeError(`value of "${e}" path must be string or number, ${typeof i} got`)}}}};var G=class extends x.Plugin{constructor(){super(...arguments);this.composer=null}saveSettings(){return n(this,null,function*(){let e=this.settings.getAll();yield this.saveData(e),(e.list_pattern===!0&&this.parser.getDelimiter()!==null||e.list_pattern!==!0&&e.list_pattern!==this.parser.getDelimiter())&&(this.parser.setDelimiter(e.list_pattern===!0?null:e.list_pattern),this.resolver.revokeAll()),this.resolver.setMetaPath(e.path),this.resolver.setExcluded(e.excluded_folders),this.composer.setState(e.m_graph,p.G),this.composer.setState(e.m_explorer,p.FE),this.composer.setState(e.m_markdown,p.MD),yield this.runManagersUpdate()})}onload(){return n(this,null,function*(){this.saveSettings=(0,x.debounce)(this.saveSettings,500,!0),this.settings=new w(yield this.loadData(),this.saveSettings.bind(this)),this.bind(),this.parser=new _,this.resolver=new u(this.app.metadataCache,this.parser,{metaPath:this.settings.get("path"),excluded:this.settings.get("excluded_folders")}),this.resolver.on("unresolved",(0,x.debounce)(()=>this.onUnresolvedHandler(),200)),this.composer=new I(this.app.workspace,this.resolver),this.app.workspace.onLayoutReady(()=>{this.composer.setState(this.settings.get("m_graph"),p.G),this.composer.setState(this.settings.get("m_explorer"),p.FE),this.composer.setState(this.settings.get("m_markdown"),p.MD),this.composer.update()}),this.addSettingTab(new C(this.app,this))})}onunload(){this.composer.setState(!1),this.resolver.removeAllListeners("unresolved")}bind(){this.registerEvent(this.app.metadataCache.on("changed",e=>{var t;(t=this.resolver)==null||t.revoke(e),this.runManagersUpdate(e).catch(console.error)})),this.registerEvent(this.app.vault.on("rename",(e,t)=>{var r;(r=this.resolver)==null||r.revoke(t),this.runManagersUpdate(e).catch(console.error)}))}runManagersUpdate(e=null){return n(this,null,function*(){yield this.composer.update(e)})}onUnresolvedHandler(){return n(this,null,function*(){yield this.runManagersUpdate()})}};
